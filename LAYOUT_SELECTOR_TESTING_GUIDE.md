# LayoutSelector 功能测试指南

## 📱 如何测试 LayoutSelector 功能

### 前提条件

1. ✅ 确保应用正在运行：`npx expo start`
2. ✅ 在设备或模拟器上打开应用
3. ✅ 已登录并选择了 Zone

---

## 🎯 测试步骤

### 1️⃣ 找到自定义仪表板

**位置**: 底部导航栏 → "自定义" 或 "Custom" 标签

**预期**:
- 看到自定义仪表板屏幕
- 顶部有标题 "自定义仪表板"
- 右上角有 "编辑" 和 "⚙️" 按钮

---

### 2️⃣ 测试 LayoutSelector 组件

**位置**: 在标题下方，编辑提示上方

**外观**:
```
┌─────────────────────────────────┐
│ ⊞  布局                          │
│    默认布局                    ▼ │
└─────────────────────────────────┘
```

**测试点**:
- ✅ 显示当前布局名称（默认是 "默认布局"）
- ✅ 有一个下拉箭头 ▼
- ✅ 卡片样式，有边框和阴影

---

### 3️⃣ 打开布局选择器

**操作**: 点击 LayoutSelector 卡片

**预期**:
1. 弹出一个模态框
2. 模态框标题: "选择布局"
3. 显示所有可用布局列表
4. 当前布局有 ✓ 标记
5. 每个布局显示：
   - 布局名称
   - 卡片数量（例如："11 个卡片"）
6. 底部有 "⚙️ 管理布局" 按钮

**截图示例**:
```
┌──────────────────────────┐
│  选择布局            ✕   │
├──────────────────────────┤
│  ✓ 默认布局              │
│     11 个卡片            │
├──────────────────────────┤
│    自定义布局            │
│     5 个卡片             │
├──────────────────────────┤
│  ⚙️ 管理布局             │
└──────────────────────────┘
```

---

### 4️⃣ 测试布局切换

**前提**: 需要有多个布局（如果没有，先创建一个）

**操作**:
1. 在布局列表中点击另一个布局

**预期**:
1. ✅ 模态框关闭
2. ✅ 显示 Toast 提示: "已切换布局"
3. ✅ LayoutSelector 显示新的布局名称
4. ✅ 仪表板内容有淡出/淡入动画
5. ✅ 显示新布局的卡片
6. ✅ 数据自动刷新

**验证**:
- 卡片数量和顺序应该与新布局一致
- 隐藏的卡片不应该显示

---

### 5️⃣ 测试"管理布局"导航

**操作**: 
1. 打开 LayoutSelector
2. 点击底部的 "⚙️ 管理布局" 按钮

**预期**:
1. ✅ 导航到 "布局管理" 屏幕
2. ✅ 显示所有布局列表
3. ✅ 可以创建、重命名、复制、删除布局

---

### 6️⃣ 测试创建新布局

**操作**:
1. 进入布局管理屏幕（点击 ⚙️ 或通过 LayoutSelector）
2. 点击右上角的 "+" 按钮
3. 输入新布局名称（例如："测试布局"）
4. 选择基于哪个布局（可选）
5. 点击 "确定"

**预期**:
1. ✅ 显示 Toast: "布局已创建"
2. ✅ 自动切换到新布局
3. ✅ 返回自定义仪表板
4. ✅ LayoutSelector 显示新布局名称

---

### 7️⃣ 测试布局切换动画

**操作**: 快速切换不同布局

**预期**:
1. ✅ 淡出动画（150ms）
2. ✅ 内容更新
3. ✅ 淡入动画（150ms）
4. ✅ 动画流畅，无卡顿

---

### 8️⃣ 测试深色模式

**操作**:
1. 切换到深色模式（在设备设置或应用设置中）
2. 打开 LayoutSelector

**预期**:
1. ✅ LayoutSelector 卡片使用深色背景
2. ✅ 文字颜色适配深色模式
3. ✅ 模态框使用深色背景
4. ✅ 所有颜色对比度良好

---

### 9️⃣ 测试错误处理

**场景 1: 切换到相同布局**
- **操作**: 点击当前已选中的布局
- **预期**: 不执行任何操作，模态框关闭

**场景 2: 网络错误（模拟）**
- **预期**: 显示错误 Toast，布局不变

---

### 🔟 测试无障碍功能

**操作**: 启用屏幕阅读器（VoiceOver/TalkBack）

**预期**:
1. ✅ LayoutSelector 有正确的 accessibilityLabel: "选择布局"
2. ✅ 每个布局项有描述: "选择布局 [名称]，包含 X 个可见卡片"
3. ✅ 当前布局标记为 selected
4. ✅ 管理布局按钮可访问

---

## ✅ 完整测试清单

### 基础功能
- [ ] LayoutSelector 组件正确显示
- [ ] 显示当前布局名称
- [ ] 点击打开模态框
- [ ] 模态框显示所有布局
- [ ] 当前布局有 ✓ 标记
- [ ] 显示卡片数量

### 布局切换
- [ ] 可以切换到其他布局
- [ ] 显示成功 Toast
- [ ] LayoutSelector 更新显示
- [ ] 仪表板内容更新
- [ ] 有淡入淡出动画
- [ ] 数据自动刷新

### 导航
- [ ] "管理布局" 按钮工作
- [ ] 导航到布局管理屏幕
- [ ] 可以返回自定义仪表板

### 布局管理
- [ ] 可以创建新布局
- [ ] 可以重命名布局
- [ ] 可以复制布局
- [ ] 可以删除布局（非最后一个）
- [ ] 创建后自动切换

### 视觉效果
- [ ] 浅色模式正确显示
- [ ] 深色模式正确显示
- [ ] 动画流畅
- [ ] 无视觉故障

### 错误处理
- [ ] 切换相同布局无操作
- [ ] 错误时显示 Toast
- [ ] 不能删除最后一个布局

### 无障碍
- [ ] 屏幕阅读器支持
- [ ] 正确的 accessibility labels
- [ ] 键盘导航（如适用）

---

## 🐛 常见问题排查

### 问题 1: LayoutSelector 不显示
**检查**:
- 是否在 CustomDashboardScreen？
- config 是否已加载？
- 查看控制台错误

### 问题 2: 切换布局无效果
**检查**:
- 查看 Toast 消息
- 检查控制台错误
- 确认布局确实不同

### 问题 3: 动画卡顿
**检查**:
- 设备性能
- 是否有大量数据
- 查看性能监控

### 问题 4: 模态框不关闭
**检查**:
- 点击外部区域
- 点击 ✕ 按钮
- 重启应用

---

## 📊 性能指标

**预期性能**:
- 打开模态框: < 100ms
- 切换布局: < 500ms（包括动画）
- 动画帧率: 60 FPS
- 内存占用: < 50MB 增量

---

## 🎥 录制测试视频

建议录制以下场景：
1. 打开 LayoutSelector
2. 切换布局（显示动画）
3. 创建新布局
4. 管理布局操作
5. 深色模式切换

---

## 📝 测试报告模板

```markdown
## LayoutSelector 测试报告

**测试日期**: YYYY-MM-DD
**测试设备**: iOS/Android
**应用版本**: 1.0.0

### 测试结果
- [ ] 所有基础功能正常
- [ ] 布局切换正常
- [ ] 动画流畅
- [ ] 深色模式正常
- [ ] 无障碍功能正常

### 发现的问题
1. [描述问题]
2. [描述问题]

### 建议改进
1. [建议]
2. [建议]
```

---

## 🚀 下一步

测试完成后，你可以：
1. 继续实现 Phase 4 的优化任务（Task 20-25）
2. 收集用户反馈
3. 优化性能和用户体验
4. 添加更多自定义选项

---

**祝测试顺利！** 🎉

如有问题，请查看：
- `TASK_19_IMPLEMENTATION_COMPLETE.md` - 实现详情
- `src/components/LayoutSelector.tsx` - 组件源码
- `src/screens/CustomDashboardScreen.tsx` - 集成代码
